import{K as Z,i as Q,k as z,t as f,l as L,r as b,Z as V,j as e,X as G,I as ee,_ as se,w as te,u as ae,s as h,C as U,B as C,L as le,J as ne,b as re,d as oe,E as ie,e as ce,g as H}from"./index-Bk_5QplK.js";import{d as de,e as me,a as xe,b as ue,C as pe}from"./CreateCategoryModal-BOnR2KYI.js";import{T as O,P as R,D as W}from"./DeleteAccountModal-CMfHn3SR.js";import{T as he}from"./textarea-B0IVzDO7.js";import{M as be}from"./CustomLoaderBtn-Dz2wmlW0.js";import{T as J,a as X,b as D,c as v,d as Y,e as S}from"./table-BsLBivAi.js";/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],K=Z("pen-line",ge),fe=i=>{const x=Q();return z({mutationFn:async t=>(await L.post("/sub-categories/",{category:i,...t})).data,onSuccess:()=>{x.invalidateQueries({queryKey:["categories"]}),x.invalidateQueries({queryKey:["category",i]}),f.success("Subcategory Created successfully!!!.")},onError:t=>{var a,d,r,o;console.error("useCreateSubCategory Error:",t),f.error(((d=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:d.detail)||((o=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to create subcategory. Please try again.")}})},je=i=>{const x=Q();return z({mutationFn:async({sub_category_id:t,payload:a})=>(await L.put("/sub-categories/",{subCategoryId:t,category:i,...a})).data,onSuccess:()=>{x.invalidateQueries({queryKey:["categories"]}),x.invalidateQueries({queryKey:["category",i]}),f.success("Sub Category Updated successfully!!!.")},onError:t=>{var a,d,r,o;console.error("useUpdateSubCategory Error:",t),f.error(((d=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:d.detail)||((o=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update sub category. Please try again.")}})},Ne=i=>{const x=Q();return z({mutationFn:async t=>(await L.delete(`/sub-categories/${t}`)).data,onSuccess:()=>{x.invalidateQueries({queryKey:["categories"]}),x.invalidateQueries({queryKey:["category",i]}),f.success("Sub Category has been deleted!.")},onError:t=>{var a,d,r,o;console.error("Error:",t),f.error(((d=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:d.detail)||((o=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to delete sub Category. Please try again.")}})},we=({isOpen:i,onClose:x,onSubmit:t,initialData:a=null,categoryId:d=null,isLoading:r=!1})=>{const[o,N]=b.useState({name:"",description:"",image:null,categoryId:d}),[M,j]=b.useState(null),[l,F]=b.useState(null),[I,B]=b.useState(0),[u,m]=b.useState(!1);b.useEffect(()=>{a?(N({name:a.name||"",description:a.description||"",image:a.imageUrl||null,categoryId:a.categoryId||d}),j(a.imageUrl||null),F(null)):(N({name:"",description:"",image:null,categoryId:d}),j(null),F(null))},[a,d,i]);const w=b.useCallback(async p=>{try{m(!0),B(0);const n=new FormData;n.append("file",p),n.append("upload_preset","jokoyoski"),n.append("folder","subcategories");const c=new XMLHttpRequest;return c.open("POST",`https://api.cloudinary.com/v1_1/${V}/image/upload`),c.upload.onprogress=g=>{if(g.lengthComputable){const P=Math.round(g.loaded/g.total*100);B(P)}},new Promise((g,P)=>{c.onload=()=>{if(m(!1),c.status>=200&&c.status<300){const _=JSON.parse(c.responseText);g(_.secure_url)}else P(new Error("Upload failed"))},c.onerror=()=>{m(!1),P(new Error("Upload failed"))},c.send(n)})}catch(n){throw m(!1),console.error("Error uploading to Cloudinary:",n),n}},[]),A=p=>{const n=p.target.files[0];if(n){if(!n.type.startsWith("image/")){f.error("Please select an image file");return}if(n.size>5*1024*1024){f.error("File size should be less than 5MB");return}F(n);const c=new FileReader;c.onload=g=>{j(g.target.result)},c.readAsDataURL(n)}},k=()=>{j(null),F(null),N(p=>({...p,image:null}))},q=async p=>{if(p.preventDefault(),!o.name.trim()){f.error("Subcategory name is required");return}try{let n=o.image;l&&(m(!0),n=await w(l));const c={name:o.name.trim(),description:o.description.trim(),image:n,categoryId:o.categoryId};a&&(c.id=a.id||a.id),t(c)}catch(n){console.error("Upload failed:",n),f.error("Failed to upload image. Please try again.")}finally{m(!1)}},y=()=>{!r&&!u&&x()};return e.jsxs(be,{isOpen:i,onClose:y,className:"rounded-[12px] px-4 md:px-8 py-8 max-w-[530px] !w-full h-full max-h-[690px] md:max-h-[725px] overflow-y-auto shadow-[0px_4px_24px_0px_rgba(0,0,0,0.15)]",maxWidth:530,containerClassName:"px-4",children:[e.jsx("button",{onClick:y,disabled:r||u,className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{className:"pb-4 border-b border-[#D6DDEB] mb-5",children:[e.jsx("h3",{className:"text-[23px] font-extrabold text-[#3F3F3F] mb-1.5",children:a?"Edit Sub-Category":"Create Sub-Category"}),e.jsx("p",{className:"text-base text-[#939393]",children:"This information can be created and edited"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-5 md:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Name Of Sub-Category"}),e.jsx(ee,{type:"text",placeholder:"Subcategory name",value:o.name,onChange:p=>N(n=>({...n,name:p.target.value})),className:"w-full  !h-[50px] border border-gray-300 rounded-[4px] px-4 focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white  p-2 text-sm leading-[140%]",disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Upload Image Of Sub Category"}),e.jsx("div",{className:"border-[0.73px] border-[#32475C1F] rounded-[6px] p-6 h-82px] text-center hover:bordray-400 transition-colors",children:M?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:M||"/placeholder.svg",alt:"Preview",className:"mx-auto h-32 w-32 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:k,disabled:r||u,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsxs("label",{htmlFor:"subcategory-image",children:[e.jsx("img",{src:de,alt:"upload-icon",className:"size-[20px] mx-auto"}),e.jsx("p",{className:"font-semibold text-base leading-[140%] text-center my-[6px] text-text-primary",children:"Upload Image of Sub Category"}),e.jsx("div",{className:"text-[#32475C99] text-xs text-center leading-[140%] ",children:"Image that should be uploaded should be 500px and good quality. Image will be uploaded when you save the subcategory."}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,disabled:r||u,className:"hidden",id:"subcategory-image"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Descriptions"}),e.jsx(he,{placeholder:"Descriptions",value:o.description,onChange:p=>N(n=>({...n,description:p.target.value})),className:"w-full min-h-[100px] resize-none border border-gray-300 rounded-[4px] px-4 placeholder:text-[#32475C99] text-sm",disabled:r})]}),e.jsxs("div",{className:"flex pt-4 md:items-center md:justify-center gap-4 flex-col md:flex-row",children:[e.jsx("button",{type:"button",onClick:y,disabled:r||u,className:"w-full  h-[50px] md:w-fit px-5 flex items-center justify-center rounded-[10px] border border-black text-black font-semibold text-base leading-[17px]",children:"Cancel SubCategory"}),e.jsx("button",{type:"submit",disabled:r||u||!o.name.trim(),className:"w-full  md:w-fit px-5  h-[50px] bg-secondary hover:bg-secondary/90 text-black rounded-[10px]  font-bold text-base leading-[17px]",children:r||u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),u?"Uploading image...":a?"Updating...":"Creating..."]}):a?"Update SubCategory":"Save SubCategory"})]})]})]})},Fe=()=>{const{id:i}=te(),x=ae(),{data:t,isLoading:a,error:d}=me(i),r=xe(),o=je(i),N=ue(),M=Ne(i),j=fe(i),l=(t==null?void 0:t.data)||null,[F,I]=b.useState(!1),[B,u]=b.useState(!1),[m,w]=b.useState(null),[A,k]=b.useState(!1),[q,y]=b.useState(!1),p=async()=>{try{await N.mutateAsync(i),k(!1),x("/dashboard/categories")}catch(s){console.log(s),k(!1)}},n=async()=>{try{await M.mutateAsync(m==null?void 0:m.id),y(!1),w(null)}catch(s){console.log(s),y(!1),w(null)}},c=()=>{I(!0)},g=()=>{w(null),u(!0)},P=s=>{w(s),u(!0)},_=async s=>{try{await r.mutateAsync({category_id:i,payload:{name:s==null?void 0:s.name,description:s==null?void 0:s.description,imageUrl:s==null?void 0:s.image}}),I(null)}catch(E){console.log(E)}},$=async s=>{try{m?await o.mutateAsync({sub_category_id:m==null?void 0:m.id,payload:{name:s==null?void 0:s.name,description:s==null?void 0:s.description,imageUrl:s==null?void 0:s.image}}):await j.mutateAsync({name:s==null?void 0:s.name,description:s==null?void 0:s.description,imageUrl:s==null?void 0:s.image}),u(!1),w(null)}catch(E){console.log(E)}};return a?e.jsxs("div",{className:"w-full px-4 md:px-10",children:[e.jsx("div",{className:"mb-6",children:e.jsx(h,{className:"h-6 w-[300px] rounded mb-3"})}),e.jsx(U,{className:"shadow-none rounded-[8px] bg-white w-full mb-6",children:e.jsxs("div",{className:" p-4 md:pl-6 md:pr-4 flex gap-3 md:gap-5 w-full",children:[e.jsx(h,{className:"w-full md:max-w-[322px] h-[204px] rounded-[4px]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(h,{className:"h-8 w-[200px] mb-4"}),e.jsx(h,{className:"h-6 w-[150px] mb-2"}),e.jsx(h,{className:"h-4 w-full mb-1"}),e.jsx(h,{className:"h-4 w-[80%]"})]})]})}),e.jsx(U,{className:"shadow-none rounded-[8px] bg-white py-4 w-full",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(h,{className:"h-8 w-[200px] mb-4 ml-8"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(J,{className:"w-full min-w-[600px]",children:[e.jsx(X,{className:"border-b border-[#D6DDEB]",children:e.jsxs(D,{className:"border-none hover:bg-transparent",children:[e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 w-16 pb-6",children:"#"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 pb-6",children:"Name of Sub-Category"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 pb-6",children:"Description"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 w-10 pb-6"})]})}),e.jsx(Y,{children:[...Array(3)].map((s,E)=>e.jsxs(D,{className:"border-none border-[#E5E7E8] hover:bg-[#F0F6FF] transition-colors",children:[e.jsx(S,{className:"py-3 pl-8",children:e.jsx(h,{className:"h-7 w-8"})}),e.jsx(S,{className:"py-3 pl-8",children:e.jsx(h,{className:"h-7 w-32"})}),e.jsx(S,{className:"py-3 pl-8",children:e.jsx(h,{className:"h-7 w-48"})}),e.jsx(S,{className:"py-3 pr-14",children:e.jsx(h,{className:"h-8 w-16"})})]},E))})]})})]})})]}):d?e.jsxs("div",{className:"w-full px-4 md:px-10",children:[e.jsx("div",{className:"mb-6",children:e.jsx(h,{className:"h-6 w-[300px] rounded mb-3"})}),e.jsx(U,{className:"shadow-none rounded-[8px] w-full px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error loading Category details"}),e.jsx("p",{className:"text-gray-500",children:"There was an error loading the category data. Please try again."}),e.jsx(C,{onClick:()=>window.location.reload(),className:"mt-4",children:"Retry"})]})})]}):l?e.jsxs("div",{className:"w-full px-4 md:px-10",children:[e.jsxs("div",{className:"mb-6 flex items-center leading-[140%] text-base md:text-[20px] font-medium",children:[e.jsx(le,{to:"/dashboard/categories",className:"hover:text-blue100 text-[#32475CAD]",children:"Categories"}),e.jsx(ne,{className:"h-4 w-4 mx-1"}),e.jsx("span",{className:"text-blue100 font-medium",children:l==null?void 0:l.name})]}),e.jsx(U,{className:"shadow-none rounded-[8px] bg-white  w-full mb-6",children:e.jsxs("div",{className:" p-4 md:pl-6 md:pr-4 flex gap-3 md:gap-5 w-full flex-col md:flex-row",children:[e.jsx("img",{src:(l==null?void 0:l.imageUrl)||"/placeholder.png",alt:l==null?void 0:l.name,className:"w-full md:max-w-[322px] max-h-[180px] md:max-h-[204px] rounded-[4px] object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between",children:[e.jsx("h2",{className:"text-gray900 leading-[100%] text-[24px] md:text-[32px] font-semibold capitalize",children:l==null?void 0:l.name}),e.jsxs("div",{className:"hidden md:flex items-center gap-3 ",children:[e.jsxs(C,{variant:"outline",onClick:c,className:"flex items-center text-primary  gap-2 bg-white rounded-[8px] border-primary leading-[24px] text-sm cursor-pointer",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Edit Category"})]}),e.jsxs(C,{variant:"outline",onClick:()=>k(!0),className:"flex items-center gap-2 cursor-pointer bg-white rounded-[8px] border border-red-300 text-red-600 hover:bg-red-50",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Delete"})]})]})]}),e.jsxs("p",{className:"text-[#7C8493] mt-1 md:mt-1.5 leading-[150%] text-[20px] md:text-[24px]",children:[(l==null?void 0:l.subCategoriesCount)||0," Subcategories"]}),e.jsx("p",{className:"text-sm md:text-base text-[#7C8493] leading-[20px] mt-1.5 max-w-[626px]",children:(l==null?void 0:l.description)||"No description available"}),e.jsxs("div",{className:" md:hidden flex items-center gap-3 mt-5 ",children:[e.jsxs(C,{variant:"outline",onClick:c,className:"flex items-center text-primary  gap-2 bg-white rounded-[8px] border-primary leading-[24px] text-sm cursor-pointer",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Edit Category"})]}),e.jsxs(C,{variant:"outline",onClick:()=>k(!0),className:"flex items-center gap-2 cursor-pointer bg-white rounded-[8px] border border-red-300 text-red-600 hover:bg-red-50",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"Delete"})]})]})]})]})}),e.jsx(U,{className:"shadow-none rounded-[8px] bg-white py-4 w-full",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4 mb-6 px-4 md:px-7",children:[e.jsx("div",{className:"h-full  !text-primary font-semibold font-outfit  rounded-none bg-transparent font-regular leading-[140%] text-base uppercase",children:"SUBCATEGORIES"}),e.jsx("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-4",children:e.jsxs(C,{onClick:g,className:"bg-[#F1C40F] h-[50px] flex justify-center items-center hover:bg-[#F1C40F]/90 text-black font-semibold px-6 py-2 rounded-[4px] whitespace-nowrap",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Create Subcategory"]})})]}),l!=null&&l.subCategories&&l.subCategories.length>0?e.jsx("div",{className:"overflow-x-auto mt-8",children:e.jsxs(J,{className:"w-full min-w-[600px]",children:[e.jsx(X,{className:"border-b border-[#D6DDEB]",children:e.jsxs(D,{className:"border-none hover:bg-transparent",children:[e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 w-16 pb-6",children:"#"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 pb-6",children:"Name of Sub-Category"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 pb-6",children:"Description"}),e.jsx(v,{className:"text-left font-bold font-outfit text-base leading-[140%] text-[#646464] pl-8 w-10 pb-6"})]})}),e.jsx(Y,{children:l.subCategories.map((s,E)=>e.jsxs(D,{className:"border-none border-[#E5E7E8] hover:bg-[#F0F6FF] transition-colors",children:[e.jsx(S,{className:"py-3 pl-8 font-semibold text-base text-[#25324B]",children:E+1}),e.jsx(S,{className:"py-3 pl-8 text-left  w-[350px]",children:e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx("img",{src:s.imageUrl||"/placeholder.png",alt:s.name,className:"w-10 h-10 rounded-[4px] object-cover"}),e.jsx("span",{className:"font-semibold text-base text-[#25324B]",children:s.name})]})}),e.jsx(S,{className:"py-3 pl-8 font-semibold text-base text-[#25324B] text-left  max-w-[200px]",children:e.jsx("div",{className:"truncate",title:s.description||"No description",children:s.description||"No description"})}),e.jsx(S,{className:"py-3 pr-14",children:e.jsxs(re,{children:[e.jsx(oe,{asChild:!0,onClick:T=>T.stopPropagation(),children:e.jsxs("button",{className:"border-[#CCCCF5] border flex items-center justify-center text-[#646464] hover:bg-gray-50 text-sm font-bold w-[90px] h-[37px] bg-transparent rounded-[4px]",children:[e.jsx(ie,{className:"w-3 h-3 mr-2.5"}),"Actions"]})}),e.jsxs(ce,{align:"end",className:"w-[150px]",children:[e.jsxs(H,{onClick:T=>{T.stopPropagation(),P(s)},children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(H,{onClick:T=>{T.stopPropagation(),w(s),y(!0)},className:"text-red-600",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Delete"})]})]})]})})]},s.id))})]})}):e.jsx("div",{className:"w-full flex flex-col items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No subcategories yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating your first subcategory for this category."}),e.jsxs(C,{variant:"primary",onClick:g,className:"bg-blue100 text-white",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Add New Subcategory"]})]})})]})}),e.jsx(W,{open:A,setOpen:k,title:"Delete Category",confirmText:"Yes, delete category",onConfirm:p,isLoading:N.isPending,children:e.jsxs("p",{className:"text-sm leading-[150%] text-gray800",children:[e.jsx("span",{className:"font-medium text-neutralBlack",children:"Are you sure you want to delete this category?"})," ","This action cannot be undone. and it will remove all sub categories attached to it. Please confirm if you want to proceed."]})}),e.jsx(W,{open:q,setOpen:y,title:"Delete SubCategory",confirmText:"Yes, delete subcategory",onConfirm:n,isLoading:M.isPending,children:e.jsxs("p",{className:"text-sm leading-[150%] text-gray800",children:[e.jsx("span",{className:"font-medium text-neutralBlack",children:"Are you sure you want to delete this sub category?"})," ","This action cannot be undone. Please confirm if you want to proceed."]})}),e.jsx(pe,{isOpen:F,onClose:()=>I(!1),onSubmit:_,initialData:l,isLoading:r==null?void 0:r.isPending}),e.jsx(we,{isOpen:B,onClose:()=>u(!1),onSubmit:$,initialData:m,categoryId:i,isLoading:(j==null?void 0:j.isPending)||(o==null?void 0:o.isPending)})]}):e.jsxs("div",{className:"w-full px-4 md:px-10",children:[e.jsx("div",{className:"mb-6",children:e.jsx(h,{className:"h-6 w-[300px] rounded mb-3"})}),e.jsx(U,{className:"shadow-none rounded-[8px] w-full px-6 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Category not found"}),e.jsx("p",{className:"text-gray-500",children:"The category you're looking for doesn't exist or has been removed."}),e.jsx(C,{onClick:()=>x("/dashboard/categories"),className:"mt-4",children:"Back to Categories"})]})})]})};export{Fe as default};
