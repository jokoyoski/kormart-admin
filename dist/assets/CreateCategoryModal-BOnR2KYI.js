import{N as E,l as y,i as A,k as w,t as d,r as m,Z as B,j as a,X as F,I as P,_ as Q}from"./index-Bk_5QplK.js";import{T as R}from"./textarea-B0IVzDO7.js";import{M as W}from"./CustomLoaderBtn-Dz2wmlW0.js";const O=(r={},e={})=>E({queryKey:["categories",r],queryFn:async()=>{try{const t=new URLSearchParams;r.page!==void 0&&t.append("page",r.page+1),r.search&&r.search.trim()&&t.append("search",r.search.trim()),r.limit&&t.append("limit",r.limit);const s=t.toString(),n=s?`/categories?${s}`:"/categories",l=await y.get(n);return console.log({response:l}),l.data}catch(t){throw console.error("Error fetching categories:",t),t}},retry:2,refetchOnWindowFocus:!1,...e}),X=(r,e={})=>E({queryKey:["category",r],queryFn:async()=>{try{return(await y.get(`/categories/${r}`)).data}catch(t){throw console.error("Error fetching category:",t),t}},retry:2,refetchOnWindowFocus:!1,...e}),_=()=>{const r=A();return w({mutationFn:async e=>(await y.post("/categories/",e)).data,onSuccess:()=>{r.invalidateQueries({queryKey:["categories"]}),d.success("Category Created successfully!!!.")},onError:e=>{var t,s,n,l;console.error("useCreateCategory Error:",e),d.error(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.detail)||((l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to create category. Please try again.")}})},z=()=>{const r=A();return w({mutationFn:async({category_id:e,payload:t})=>(await y.put("/categories/",{categoryId:e,...t})).data,onSuccess:(e,t)=>{r.invalidateQueries({queryKey:["categories"]}),r.invalidateQueries({queryKey:["category",t==null?void 0:t.category_id]}),d.success("Category Updated successfully!!!.")},onError:e=>{var t,s,n,l;console.error("useUpdateCategory Error:",e),d.error(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.detail)||((l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to update category. Please try again.")}})},G=()=>{const r=A();return w({mutationFn:async e=>(await y.delete(`/categories/${e}`)).data,onSuccess:(e,t)=>{r.invalidateQueries({queryKey:["categories"]}),r.invalidateQueries({queryKey:["category",t]}),d.success("Category has been deleted!.")},onError:e=>{var t,s,n,l;console.error("Error:",e),d.error(((s=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:s.detail)||((l=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:l.message)||"Failed to delete Category. Please try again.")}})},M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFASURBVHgBjZLNTcNAEIVfHBfgI8eVCPftgFABUEFCBSgV2KkAqICkAkMFoYQtAMQeuWFuHILMm8kuJJZje6TRWuP55n+MAWKMNVl2gqr6+G7+G3WCp/aKzx29TDA5bHHtvfPRJ+mAZwRLqqfe0LRAjQxjbFhRhp7MMzOxNd8VGq3Q/kktoi09knnFbGv/5uYCSVba1v7VFYQ93WxrC0dhkS3tItLGniSD4B9cyOCYPdeB1iEYwhbUOcV7LwwU1KW0clhBikfCfihszqwNNiRhJVPW8qDQAJjJNtR5rCAOxWkw6ZHBeuBKEqCxBUuoklaot4TLLjheYxI+XqiXsXS9vlp3veiC/7cgNy9ny4wElti/jYmd8inb4L8AwbHgk2sLIzzx+4t6rgMWWwt8EECD7ErNFdoN11GfeYX3Op8W+QVBT8q00ImXhgAAAABJRU5ErkJggg==",J=({isOpen:r,onClose:e,onSubmit:t,initialData:s=null,isLoading:n=!1})=>{const[l,x]=m.useState({name:"",description:"",image:null}),[j,h]=m.useState(null),[N,f]=m.useState(null),[K,v]=m.useState(0),[u,g]=m.useState(!1);m.useEffect(()=>{s?(x({name:s.name||"",description:s.description||"",image:s.imageUrl||null}),h(s.imageUrl||null),f(null)):(x({name:"",description:"",image:null}),h(null),f(null))},[s,r]);const U=m.useCallback(async i=>{try{g(!0),v(0);const o=new FormData;o.append("file",i),o.append("upload_preset","jokoyoski"),o.append("folder","categories");const c=new XMLHttpRequest;return c.open("POST",`https://api.cloudinary.com/v1_1/${B}/image/upload`),c.upload.onprogress=p=>{if(p.lengthComputable){const b=Math.round(p.loaded/p.total*100);v(b)}},new Promise((p,b)=>{c.onload=()=>{if(g(!1),c.status>=200&&c.status<300){const I=JSON.parse(c.responseText);p(I.secure_url)}else b(new Error("Upload failed"))},c.onerror=()=>{g(!1),b(new Error("Upload failed"))},c.send(o)})}catch(o){g(!1),d.error("Error uploading to Cloudinary:"),console.error("Error uploading to Cloudinary:",o)}},[]),q=i=>{const o=i.target.files[0];if(o){if(!o.type.startsWith("image/")){d.error("Please select an image file");return}if(o.size>5*1024*1024){d.error("File size should be less than 5MB");return}f(o);const c=new FileReader;c.onload=p=>{h(p.target.result)},c.readAsDataURL(o)}},k=()=>{h(null),f(null),x(i=>({...i,image:null}))},S=async i=>{if(i.preventDefault(),!l.name.trim()){d.error("Category name is required");return}try{let o=l.image;N&&(g(!0),o=await U(N));const c={name:l.name.trim(),description:l.description.trim(),image:o};s&&(c.id=s.id||s.id),t(c)}catch(o){console.error("Upload failed:",o),d.error("Failed to upload image. Please try again.")}finally{g(!1)}},C=()=>{!n&&!u&&e()};return a.jsxs(W,{isOpen:r,onClose:C,className:"rounded-[12px] px-4 md:px-8 py-8 max-w-[580px] !w-full h-fit max-h-[690px] md:max-h-[725px] overflow-y-auto shadow-[0px_4px_24px_0px_rgba(0,0,0,0.15)]",maxWidth:580,containerClassName:"px-4",children:[a.jsx("button",{onClick:C,className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-full transition-colors",children:a.jsx(F,{className:"w-5 h-5 text-gray-500"})}),a.jsxs("div",{className:"pb-4 border-b border-[#D6DDEB] mb-5",children:[a.jsx("h3",{className:"text-[23px] font-extrabold text-[#3F3F3F] mb-1.5",children:s?"Edit Category":"Create Category"}),a.jsx("p",{className:"text-base text-[#939393]",children:"This information can be created and edited"})]}),a.jsxs("form",{onSubmit:S,className:"space-y-5 md:space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Name of Category"}),a.jsx(P,{type:"text",placeholder:"Category name",value:l.name,onChange:i=>x(o=>({...o,name:i.target.value})),className:"w-full  !h-[50px] border border-gray-300 rounded-[4px] px-4 focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white  p-2 text-sm leading-[140%]",disabled:n})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Upload Image Of Category"}),a.jsx("div",{className:"border border-gray-300 rounded-[4px] px-4  py-4 text-center hover:bordray-400 transition-colors",children:j?a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:j||"/placeholder.svg",alt:"Preview",className:"mx-auto h-32 w-32 object-cover rounded-lg"}),a.jsx("button",{type:"button",onClick:k,disabled:n||u,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:a.jsx(F,{className:"h-4 w-4"})})]}):a.jsxs("label",{htmlFor:"category-image",children:[a.jsx("img",{src:M,alt:"upload-icon",className:"size-[20px] mx-auto"}),a.jsx("p",{className:"font-semibold text-base leading-[140%] text-center my-[6px] text-text-primary",children:"Upload Image of Category"}),a.jsx("div",{className:"text-[#32475C99] text-xs text-center leading-[140%] ",children:"Image that should be uploaded should be 500px and good quality. Image will be uploaded when you save the category."}),a.jsx("input",{type:"file",accept:"image/*",onChange:q,disabled:n||u,className:"hidden",id:"category-image"})]})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-[#25324B] mb-2",children:"Descriptions"}),a.jsx(R,{placeholder:"Descriptions",value:l.description,onChange:i=>x(o=>({...o,description:i.target.value})),className:"w-full min-h-[100px] resize-none border border-gray-300 rounded-[4px] px-4 placeholder:text-[#32475C99] text-sm",disabled:n})]}),a.jsxs("div",{className:"flex pt-4 md:items-center md:justify-center gap-4 flex-col md:flex-row",children:[a.jsx("button",{type:"button",onClick:C,disabled:n||u,className:"w-full  h-[50px] md:w-fit px-5 flex items-center justify-center rounded-[10px] border border-black text-black font-semibold text-base leading-[17px]",children:"Cancel Category"}),a.jsx("button",{type:"submit",disabled:n||u||!l.name.trim(),className:"w-full  md:w-fit  h-[50px] px-5 bg-secondary hover:bg-secondary/90 text-black rounded-[10px]  font-bold text-base leading-[17px]",children:n||u?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"h-4 w-4 animate-spin"}),u?"Uploading image...":s?"Updating...":"Creating..."]}):s?"Update Category":"Save Category"})]})]})]})};export{J as C,z as a,G as b,O as c,M as d,X as e,_ as u};
