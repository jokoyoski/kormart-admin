import{i as P,k as D,t as N,l as V,R as ee,r as v,j as t,m as te,n as M,c as b,T,O as I,o as K,f as ae,p as se,C as ne,S as ie,I as le,D as re,b as oe,d as de,E as ce,e as ue,g as S,q as me,s as k,v as A}from"./index-Bk_5QplK.js";import{C as xe}from"./CustomConfirmModal-Rx9wlRAB.js";import{u as fe}from"./useTableFilters-C6V-EHDK.js";import{C as F,a as E}from"./circle-x-DakC9dnq.js";import{U as pe,a as ye}from"./user-x-DFo2vCQY.js";import"./CustomLoaderBtn-Dz2wmlW0.js";const ge=()=>{const s=P();return D({mutationFn:async({userId:a,status:e})=>(await V.patch("/staffs/update-user-status",{userId:a,status:e})).data,onSuccess:(a,e)=>{s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["user-stats"]}),s.invalidateQueries({queryKey:["user",e.userId]});const n=e.status==="activate"?"activated":"deactivated";N.success(`User ${n} successfully!`)},onError:a=>{var e,n,r,o;console.error("useUpdateUserStatus Error:",a),N.error(((n=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:n.detail)||((o=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update user status. Please try again.")}})},he=()=>{const s=P();return D({mutationFn:async a=>(await V.patch(`/staffs/verify-user/${a}`)).data,onSuccess:(a,e)=>{s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["user-stats"]}),s.invalidateQueries({queryKey:["user",e]}),N.success("User verified successfully!")},onError:a=>{var e,n,r,o;console.error("useVerifyUser Error:",a),N.error(((n=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:n.detail)||((o=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to verify user. Please try again.")}})},ve=()=>{const s=P();return D({mutationFn:async a=>(await V.patch(`/staffs/revoke-verification/${a}`)).data,onSuccess:(a,e)=>{s.invalidateQueries({queryKey:["users"]}),s.invalidateQueries({queryKey:["user-stats"]}),s.invalidateQueries({queryKey:["user",e]}),N.success("User verification revoked successfully!")},onError:a=>{var e,n,r,o;console.error("useUnverifyUser Error:",a),N.error(((n=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:n.detail)||((o=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to revoke user verification. Please try again.")}})};function Q(s){var a,e,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(a=0;a<r;a++)s[a]&&(e=Q(s[a]))&&(n&&(n+=" "),n+=e)}else for(e in s)s[e]&&(n&&(n+=" "),n+=e);return n}function je(){for(var s,a,e=0,n="",r=arguments.length;e<r;e++)(s=arguments[e])&&(a=Q(s))&&(n&&(n+=" "),n+=a);return n}const O=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,q=je,be=(s,a)=>e=>{var n;if((a==null?void 0:a.variants)==null)return q(s,e==null?void 0:e.class,e==null?void 0:e.className);const{variants:r,defaultVariants:o}=a,f=Object.keys(r).map(c=>{const u=e==null?void 0:e[c],d=o==null?void 0:o[c];if(u===null)return null;const m=O(u)||O(d);return r[c][m]}),j=e&&Object.entries(e).reduce((c,u)=>{let[d,m]=u;return m===void 0||(c[d]=m),c},{}),g=a==null||(n=a.compoundVariants)===null||n===void 0?void 0:n.reduce((c,u)=>{let{class:d,className:m,...w}=u;return Object.entries(w).every(C=>{let[U,y]=C;return Array.isArray(y)?y.includes({...o,...j}[U]):{...o,...j}[U]===y})?[...c,d,m]:c},[]);return q(s,f,g,e==null?void 0:e.class,e==null?void 0:e.className)},Ne=ee,we=te,_=v.forwardRef(({className:s,...a},e)=>t.jsx(I,{className:b("fixed inset-0 z-50 bg-blck/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:e}));_.displayName=I.displayName;const Ue=be("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:ma-w-sm",right:"inset-y-0 right-0 h-full w-3/4 brder-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:mx-w-sm"}},defaultVariants:{side:"right"}}),B=v.forwardRef(({side:s="right",className:a,children:e,...n},r)=>t.jsxs(we,{children:[t.jsx(_,{}),t.jsx(M,{ref:r,className:b(Ue({side:s}),a),...n,children:e})]}));B.displayName=M.displayName;const z=({className:s,...a})=>t.jsx("div",{className:b("flex flex-col space-y-2 text-center sm:text-left",s),...a});z.displayName="SheetHeader";const L=v.forwardRef(({className:s,...a},e)=>t.jsx(T,{ref:e,className:b("text-lg font-semibold text-foreground",s),...a}));L.displayName=T.displayName;const Ce=v.forwardRef(({className:s,...a},e)=>t.jsx(K,{ref:e,className:b("text-sm text-muted-foreground",s),...a}));Ce.displayName=K.displayName;function Se({open:s,onOpenChange:a,user:e}){var r,o,f;if(!e)return null;const n=({label:j,value:g,isBoolean:c=!1})=>t.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-200 last:border-0",children:[t.jsx("span",{className:"text-sm text-gray-600 font-medium",children:j}),c?t.jsx("span",{className:b("px-3 py-1 rounded-full text-xs font-medium",g?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:g?"Yes":"No"}):t.jsx("span",{className:"text-sm text-gray-900 font-medium text-right max-w-[60%] break-words",children:g})]});return t.jsx(Ne,{open:s,onOpenChange:a,children:t.jsxs(B,{className:"w-full sm:max-w-md overflow-y-auto !border-0 bg-white",children:[t.jsx(z,{children:t.jsx(L,{children:"User Details"})}),t.jsxs("div",{className:"mt-6 space-y-1",children:[t.jsx(n,{label:"User ID",value:e==null?void 0:e.id}),t.jsx(n,{label:"Full Name",value:((r=e==null?void 0:e.userDetails)==null?void 0:r.fullName)??"NA"}),t.jsx(n,{label:"Username",value:((o=e==null?void 0:e.userDetails)==null?void 0:o.username)??"NA"}),t.jsx(n,{label:"Email",value:e==null?void 0:e.email}),t.jsx(n,{label:"Phone Number",value:((f=e==null?void 0:e.userDetails)==null?void 0:f.telephone)??"NA"}),t.jsx(n,{label:"Active",value:e==null?void 0:e.isActive,isBoolean:!0}),t.jsx(n,{label:"Verified",value:e==null?void 0:e.isVerified,isBoolean:!0}),t.jsx(n,{label:"Wallet Activated",value:e==null?void 0:e.isWalletActivated,isBoolean:!0}),t.jsx(n,{label:"Suspended",value:e==null?void 0:e.isSuspended,isBoolean:!0}),t.jsx(n,{label:"Profile Completed",value:e==null?void 0:e.hasCompletedProfile,isBoolean:!0}),t.jsx(n,{label:"Registered On",value:ae(new Date(e==null?void 0:e.createdAt),"MMM d, yyyy h:mm a")})]})]})})}const Ae=()=>{const[s,a]=v.useState(null),[e,n]=v.useState(!1),{searchFilter:r,currentPage:o,itemsPerPage:f,handleSearchChange:j,setCurrentPage:g}=fe({itemsPerPage:20}),[c,u]=v.useState(!1),[d,m]=v.useState(null),w=ge(),C=he(),U=ve(),{data:y,isLoading:$}=se({page:o,search:r,limit:f}),R=(y==null?void 0:y.data)||[],H=(y==null?void 0:y.meta)||{count:0},W=i=>{var l;m({type:"activate",title:"Activate User",message:`Are you sure you want to activate ${((l=i==null?void 0:i.userDetails)==null?void 0:l.fullName)||i.email}?`,action:()=>w.mutateAsync({userId:i.id,status:"activate"})}),u(!0)},G=i=>{var l;m({type:"deactivate",title:"Deactivate User",message:`Are you sure you want to deactivate ${((l=i==null?void 0:i.userDetails)==null?void 0:l.fullName)||i.email}?`,action:()=>w.mutateAsync({userId:i.id,status:"deactivate"})}),u(!0)},X=i=>{var l;m({type:"verify",title:"Verify User",message:`Are you sure you want to verify ${((l=i==null?void 0:i.userDetails)==null?void 0:l.fullName)||i.email}?`,action:()=>C.mutateAsync(i.id)}),u(!0)},Y=i=>{var l;m({type:"unverify",title:"Revoke Verification",message:`Are you sure you want to revoke verification for ${((l=i==null?void 0:i.userDetails)==null?void 0:l.fullName)||i.email}?`,action:()=>U.mutateAsync(i.id)}),u(!0)},J=async()=>{try{await d.action(),u(!1),m(null)}catch(i){console.error("Action failed:",i)}},Z=[{header:"NO",accessor:"index",enableSorting:!1,cell:i=>t.jsx("span",{children:o*f+i.row.index+1})},{header:"Full Name",accessor:"fullName",enableSorting:!1,cell:i=>{var x;const l=i.row.original,p=((x=l==null?void 0:l.userDetails)==null?void 0:x.fullName)||"N/A";return t.jsx("span",{className:"block min-w-[150px]",children:p})}},{header:"Username",accessor:"username",enableSorting:!1,cell:i=>{var x;const l=i.row.original,p=((x=l==null?void 0:l.userDetails)==null?void 0:x.username)||"N/A";return t.jsx("span",{children:p})}},{header:"Email Address",accessor:"email",enableSorting:!1,cell:i=>{const l=i.getValue();return t.jsx("span",{children:l})}},{header:"Phone",accessor:"telephone",enableSorting:!1,cell:i=>{var p,x;const l=((x=(p=i.row.original)==null?void 0:p.userDetails)==null?void 0:x.telephone)||"N/A";return t.jsx("span",{children:l})}},{header:"Status",accessor:"isActive",enableSorting:!1,cell:i=>{const l=i.row.original,p=l.isActive,x=l.isVerified;return t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("div",{className:b("w-fit px-2 py-1 rounded-full text-xs font-semibold leading-[140%] flex items-center justify-center",p?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:p?"Active":"Inactive"}),x?t.jsxs("div",{className:"w-fit px-2 py-1 rounded-full text-xs font-semibold leading-[140%] flex items-center justify-center bg-blue-100 text-blue-800",children:[t.jsx(F,{className:"w-3 h-3 mr-1"}),"Verified"]}):t.jsxs("div",{className:"w-fit px-2 py-1 rounded-full text-xs font-semibold leading-[140%] flex items-center justify-center bg-gray-100 text-gray-600",children:[t.jsx(E,{className:"w-3 h-3 mr-1"}),"Not Verified"]})]})}},{header:"",accessor:"action",cell:i=>{const l=i.row.original,p=l.isActive,x=l.isVerified;return t.jsxs(oe,{children:[t.jsx(de,{asChild:!0,onClick:h=>h.stopPropagation(),children:t.jsx("div",{className:"size-[20px] rounded-full p-0 flex items-center justify-center cursor-pointer bg-[#F4F7FE] hover:bg-gray-100 ",children:t.jsx(ce,{className:"size-4 text-primary500"})})}),t.jsxs(ue,{align:"end",className:"w-[180px] py-[10px] border-[#E5E7E8] shadow-[0px_4px_24px_0px_#191B1C29]",children:[p?t.jsxs(S,{className:"p-0 text-sm text-red-600 leading-[140%] px-3 py-1.5",onClick:h=>{h.stopPropagation(),G(l)},children:[t.jsx(ye,{className:"mr-2 size-4"}),t.jsx("span",{children:"Deactivate"})]}):t.jsxs(S,{className:"p-0 text-sm text-green-600 leading-[140%] px-3 py-1.5",onClick:h=>{h.stopPropagation(),W(l)},children:[t.jsx(pe,{className:"mr-2 size-4"}),t.jsx("span",{children:"Activate"})]}),x?t.jsxs(S,{className:"p-0 text-sm text-orange-600 leading-[140%] px-3 py-1.5",onClick:h=>{h.stopPropagation(),Y(l)},children:[t.jsx(E,{className:"mr-2 size-4"}),t.jsx("span",{children:"Unverify"})]}):t.jsxs(S,{className:"p-0 text-sm text-blue-600 leading-[140%] px-3 py-1.5",onClick:h=>{h.stopPropagation(),X(l)},children:[t.jsx(F,{className:"mr-2 size-4"}),t.jsx("span",{children:"Verify"})]})]})]})}}];return t.jsxs(t.Fragment,{children:[t.jsxs(ne,{className:" shadow-none rounded-[8px] bg-white pt-7 pb-4 w-full mt-5",children:[t.jsx("div",{className:"flex items-center justify-end gap-6 px-4 mb-4",children:t.jsxs("div",{className:"relative w-full max-w-[290px]",children:[t.jsx(ie,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray900"}),t.jsx(le,{placeholder:"Search users...",value:r,onChange:j,className:"pl-9 w-full bg-[#F2F3F480] h-10 border-none rounded-[4px]  focus:ring-none text-gray900 text-sm placeholder:text-gray400"})]})}),t.jsx("div",{children:t.jsx(re,{tableColumns:Z,tableData:R||[],enableGlobalFilter:!0,enablePagination:!0,showPagination:!0,showSearch:!1,perPageOptions:[10,20,30,50],emptyHeading:"No users found",emptySubtitle:"There are no users matching your search criteria.",onRowClick:i=>{a(i),n(!0)},loading:$,serverSidePagination:!0,manualPagination:!0,totalItemsCount:H.count,currentPage:o,itemsPerPage:f,onPageChange:g})})]}),t.jsx(xe,{open:c,setOpen:u,title:(d==null?void 0:d.title)||"Confirm Action",secondaryBtnText:(d==null?void 0:d.title)||"Confirm",actionType:(d==null?void 0:d.type)||"default",onSecondaryBtnClick:J,isLoading:w.isPending||C.isPending||U.isPending,children:t.jsx("p",{className:"text-sm text-gray-600",children:(d==null?void 0:d.message)||"Are you sure you want to perform this action?"})}),t.jsx(Se,{open:e,onOpenChange:n,user:s})]})},Oe=()=>{var n,r,o,f;const{data:s,isLoading:a}=me(),e=(s==null?void 0:s.data)||{totalUsers:0,activeUsers:0,inactiveUsers:0,deletedUsers:0};return t.jsx("div",{className:"w-full px-4 md:px-10",children:t.jsxs("div",{className:" w-full pt-4 ",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-[20px] text-gray900 font-extrabold leading-[140%]",children:"User Management"}),t.jsx("p",{className:"mt-1 text-sm text-gray600 leading-[140%]",children:"Here is all your Kormat analytics overview"})]}),t.jsx("div",{className:"mt-4 md:mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-7",children:a?t.jsx(t.Fragment,{children:[...Array(4)].map((j,g)=>t.jsxs("div",{className:"bg-white rounded-[8px] p-4 md:p-6",children:[t.jsx(k,{className:"h-4 w-24 mb-2"}),t.jsx(k,{className:"h-8 w-16"})]},g))}):t.jsxs(t.Fragment,{children:[t.jsx(A,{title:"Total Users",value:((n=e.totalUsers)==null?void 0:n.toLocaleString())||"0",icon:null}),t.jsx(A,{title:"Active Users",value:((r=e.activeUsers)==null?void 0:r.toLocaleString())||"0",icon:null}),t.jsx(A,{title:"Inactive Users",value:((o=e.inactiveUsers)==null?void 0:o.toLocaleString())||"0",icon:null}),t.jsx(A,{title:"Deleted Users",value:((f=e.deletedUsers)==null?void 0:f.toLocaleString())||"0",icon:null})]})}),t.jsx(Ae,{})]})})};export{Oe as default};
